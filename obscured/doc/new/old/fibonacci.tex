\documentclass{article}
\usepackage{/home/jeroen/studie/dw/graphs/graphs}
\usepackage{amsfonts, amssymb}
\frenchspacing
\begin{document}

\newcommand{\qed}{$\blacksquare$}

\section*{}

\section*{The Fibonacci substitution}
The Fibonacci substitution:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow ab\\
b \rightarrow a
\end{array} \right.
\end{displaymath}
With $a$ as the initial letter gives the following fixed point:
\begin{verbatim}
  u = abaababaabaababaababaabaababaabaababaababaabaababaaba...
\end{verbatim}
This is the automaton associated with the substitution:\\
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0}
  \dirbow{s1}{s2}{.2} \bowtext{s1}{s2}{.2}{1}
  \dirbow{s2}{s1}{.2} \bowtext{s2}{s1}{.2}{0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
To make this automaton work, we need to feed it with the Zeckendorf expansion
of an integer $n$.\\
\paragraph{The Fibonacci sequence}
Let $(F_n)_{n \in \mathbb{N}}$ be the sequence of integers defined by $F_0 = 1,
F_1 = 2$ and for any integer $n > 1, F_{n + 1} = F_{n - 1} + F_n$.\\
\paragraph{The Zeckendorf expansion}
If $n = \sum_{i = 0}^k n_i F_i$ with $n_k = 1, n_i \in \{0, 1\}$ and
$\forall (i < k) \{n_i n_{i + 1} = 0\}$, we say that
Zeck$(n) = n_k n_{k - 1} ... n_0 \in \{0, 1\}^{k + 1}$ is the Zeckendorf
expansion of the integer $n$.\\
\\
If we write the partitions of
$\mathbb{F}$ as $\mathbb{F}_a$ and $\mathbb{F}_b$,
\begin{eqnarray*}
  \mathbb{F}_a &=& \{0, 2, 3, 5, 7, 8, 10, 11, 13, 15, ...\}\\
  \mathbb{F}_b &=& \{1, 4, 6, 9, 12, 14, 17, 19, 22, 25, ...\}
\end{eqnarray*}
Then
\begin{eqnarray*}
  \mathbb{F}_a &=& \{n \in \mathbb{N}, \mathrm{Zeck}(n) \in \{0, 1\}^* 0\}\\
  \mathbb{F}_b &=& \{n \in \mathbb{N}, \mathrm{Zeck}(n) \in \{0, 1\}^* 1\}
\end{eqnarray*}
Hence we get an $a$ at position $n$ if $n$ ends with a 0 in the
Zeckendorf expansion, we get an $b$ otherwise.

\paragraph{Fibonacci's `brother'}
There seems to be a class of substitutions for which we can find an enumeration
system. Here is a little example:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow ab\\
b \rightarrow b
\end{array} \right.
\end{displaymath}
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0}
  \diredge{s1}{s2} \edgetext{s1}{s2}{1}
  \dirloopedge{s2}{50}(1, 0) \freetext(1.6, 0){0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
The enumeration system for this substitution is based on the sequence of 
integers in $\mathbb{N}^+$. So the first few expansions are as follows:
\begin{verbatim}
0 -> 0
1 -> 1
2 -> 10
3 -> 100
4 -> 1000
 ...
\end{verbatim}

\section*{A generalization}
But can we find a more general way for this phenomenon? The answer seems to
be yes for a (possibly small) class of substitutions. This class can be found
by calculating the sequence on which the expansion is based from the 
substitution itself. If we look at the Fibonacci substitution, we see that for
each word $\sigma_n$:
\begin{eqnarray*}
|\sigma_n|_a &=& |\sigma_{n - 1}|_a + |\sigma_{n - 1}|_b\\
|\sigma_n|_b &=& |\sigma_{n - 1}|_a
\end{eqnarray*}
Or in matrix form:
\begin{displaymath} \left( \begin{array}{cc}
1 & 1\\
1 & 0
\end{array} \right) \end{displaymath}
If we now define the initial matrix as:
\begin{displaymath} \left( \begin{array}{c}
1 \\
0 
\end{array} \right) \end{displaymath}
and multiply it repeatedly with the (2 $\times$ 2) matrix, we obtain:
\begin{displaymath} 
\left( \begin{array}{c}
1 \\
0 
\end{array} \right),
\left( \begin{array}{c}
1 \\
1 
\end{array} \right),
\left( \begin{array}{c}
2 \\
1 
\end{array} \right),
\left( \begin{array}{c}
3 \\
2 
\end{array} \right),
\left( \begin{array}{c}
5 \\
3 
\end{array} \right),
\left( \begin{array}{c}
8 \\
5 
\end{array} \right),
\left( \begin{array}{c}
13 \\
8 
\end{array} \right)
\end{displaymath}
And if we now add the rows of the matrices we obtain the Fibonacci sequence.
The matrix for the `brother' of the Fibonacci sequence is:
\begin{displaymath} \left( \begin{array}{cc}
1 & 0\\
1 & 1
\end{array} \right) \end{displaymath}
Which applied to the initial matrix yields the sequence of integers in $\mathbb{N}^+$.\\
By using this method we can cover all $k$-automata, the Fibonacci automaton and
its `brother' and, as we shall see, at least one one other class of automata.
\\
Note that we need to define a more general Zeckendorf-like expansion to make
the automata work. It seems that a simple greedy algorithm works fine in most
cases:\\
\\
Let $S$ be a sequence obtained from the method described above. We observe
that a sequence like this is strictly increasing and grows at least as fast
as $n$ and at most as fast as $k^n$.\\
If $n = \sum_{i = 0}^k n_i S_i$ with $0 < n_k < k$ and 
$\forall (i < k) \{0 \le n_i < k\}$, we say that 
$n_k n_{k - 1} ... n_0$ is the expansion of $n$ in the $S$ enumeration system.

\section*{Survey}
Now we look at which substitutions are `automatic' in their own enumeration
system. We have already seen that the Fibonacci automaton and the $k$-automata
have this property.

\paragraph{The extended Fibonacci automata}
Here is an example of an other substitution that is automatic in its own
enumeration system:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow ab\\
b \rightarrow ac\\
c \rightarrow b
\end{array} \right.
\end{displaymath}
This is the automaton associated with the substitution:\\
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}
  \roundnode{s3}(2, 0)  \nodetext{s3}(0, 0){$c$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0}
  \dirbow{s1}{s2}{.2} \bowtext{s1}{s2}{.2}{1}
  \dirbow{s2}{s1}{.2} \bowtext{s2}{s1}{.2}{0}
  \dirbow{s2}{s3}{.2} \bowtext{s2}{s3}{.2}{1}
  \dirbow{s3}{s2}{.2} \bowtext{s3}{s2}{.2}{0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
Just like the Fibonacci automaton, this one has a couple of `brothers and 
sisters':\\
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}
  \roundnode{s3}(2, 0)  \nodetext{s3}(0, 0){$c$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0}
  \dirbow{s1}{s2}{.2} \bowtext{s1}{s2}{.2}{1}
  \dirbow{s2}{s1}{.2} \bowtext{s2}{s1}{.2}{0}
  \diredge{s2}{s3} \edgetext{s2}{s3}{1}
  \dirbow{s3}{s1}{.3} \bowtext{s3}{s1}{.3}{0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
And:\\
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}
  \roundnode{s3}(2, 0)  \nodetext{s3}(0, 0){$c$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0}
  \dirbow{s1}{s2}{.2} \bowtext{s1}{s2}{.2}{1}
  \dirbow{s2}{s1}{.2} \bowtext{s2}{s1}{.2}{0}
  \diredge{s2}{s3} \edgetext{s2}{s3}{1}
  \dirloopedge{s3}{50}(1,0) \freetext(3.6, 0){0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
The same seems to hold for the following substitution:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow ab\\
b \rightarrow ac\\
c \rightarrow ad\\
d \rightarrow c
\end{array} \right.
\end{displaymath}
And also for its `family', which has four members.\\
\\
But we can also increase the number of transitions, instead of the number of
states, these sequences look like this:\\
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow aab\\
b \rightarrow aa\\
\end{array} \right.
\end{displaymath}
(There are two of those, $b$ may also go to $ab$). And:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow aab\\
b \rightarrow aac\\
c \rightarrow a
\end{array} \right.
\end{displaymath}
And this is the automaton associated with the last substitution:\\
\begin{graph}(0, 3)(-4, -1.5)
  \graphnodecolour{1}
  \graphnodesize{1}
  \roundnode{s1}(-2, 0) \nodetext{s1}(0, 0){$a$}
  \roundnode{s2}(0, 0)  \nodetext{s2}(0, 0){$b$}
  \roundnode{s3}(2, 0)  \nodetext{s3}(0, 0){$c$}

  \dirloopedge{s1}{50}(-1, 0) \freetext(-3.6, 0){0,1}
  \dirbow{s1}{s2}{.2} \bowtext{s1}{s2}{.2}{2}
  \dirbow{s2}{s1}{.2} \bowtext{s2}{s1}{.2}{0,1}
  \diredge{s2}{s3} \edgetext{s2}{s3}{2}
  \dirbow{s3}{s1}{.3} \bowtext{s3}{s1}{.3}{0}

  \freetext(-2, -0.7){$\Uparrow$}
\end{graph}\\
And here we stumble upon a quite large family which all have a matrix of this 
form:
\begin{displaymath}
\left( \begin{array}{cccccc}
k - 1 & x_{0, 1} & x_{0, 2} & x_{0, 3} & \ldots & x_{0, n}\\
1 & 0 & 0 & 0 & \ldots & x_{1, n}\\
0 & 1 & 0 & 0 & \ldots & x_{2, n}\\
0 & 0 & 1 & 0 & \ldots & x_{3, n}\\
\vdots & \vdots & \vdots & \ddots & \ldots & \vdots\\
0 & 0 & 0 & \ldots & 1 & x_{n, n}
\end{array} \right)
\end{displaymath}
In which $x$ can be any value between 0 and $k - 1$.\\
It seems that if a substitution conforms to te following three rules, it
is automatic in its own expansion:\\
Let $\sigma = \sigma_0, \sigma_1, ... \sigma_n$ and let $a$ be the initial 
letter, then $\sigma$ is automatic if:\\
$\sigma_0$ starts with $k - 1$ $a$'s,\\
$\sigma_i, 0 < 1 < k$ starts with zero or more $a$'s, followed by zero or one 
non-$a$.\\

\section{Problems}
The first problem that arises when we use the greedy approach is that we
could stumble upon a substitution that is automatic, but its automaton does
not accept all the language we construct. This is the result of the way our
expansion works. Here is an example:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow aab\\
b \rightarrow c\\
c \rightarrow aab
\end{array} \right.
\end{displaymath}
This is an automatic sequence and so should the following one be:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow aab\\
b \rightarrow c\\
c \rightarrow aac
\end{array} \right.
\end{displaymath}
The following expansion sequence is used for the enumeration system:
\begin{displaymath}
\{1, 3, 7, 17, 43, 109, 275, 693, 1747, 4405, 11107, ... \}
\end{displaymath}
But the first problem we encounter is when we try to calculate the 41-th
letter of the fixed point:
\begin{displaymath}
41_{10} = 2100_{\mathrm{subst}}
\end{displaymath}
which is not accepted by our automaton, but there is another expansion of
41, to say:
\begin{displaymath}
41_{10} = 2021_{\mathrm{subst}}
\end{displaymath}
So how do we know which expansion to take? The answer is: use the automaton
itself; if it rejects an input word, try the next expansion until the
automaton accepts it or until there are no more expansions.\\
\\
We conjecture that if we are dealing with an automatic expansion, we will
find a valid expansion before we run out of them.
Moreover: the automaton should only accept only one expansion if it has more
than one representation.
We also suspect that there are at most two (or possibly k) possible expansions
of an integer.
In any case, there seems to be an elegant way to work around this problem.
All we need to do is walking through the automaton while expanding an integer,
if we want to expand the next `digit', we can ony use the labels of the
outgoing transitions. This *should* always give the correct expansion.\\
\\
Here is an example of a non-automatic sequence:
\begin{displaymath}
\sigma: \left\{ \begin{array}{l}
a \rightarrow ab\\
b \rightarrow ac\\
c \rightarrow bd\\
d \rightarrow c
\end{array} \right.
\end{displaymath}
The expansion sequence is:
\begin{displaymath}
\{1, 2, 4, 8, 15, 29, 54, 103, 192, 364, 680, 1285, 2405, 4536, 8501, ... \}
\end{displaymath}
nd we run into trouble when we hit 51:
\begin{displaymath}
51_{10} = 110111_{\mathrm{subst}}
\end{displaymath}
And there is no other expansion possible.\\
\\
We took this example because we can probably see that a substitution is not
automatic (the 1 in the second row, third column should be 0):
\begin{displaymath}
\sigma: \left( \begin{array}{cccc}
1 & 1 & 0 & 0 \\
1 & 0 & 1 & 0 \\
0 & 1 & 0 & 1 \\
0 & 0 & 1 & 0
\end{array} \right)
\end{displaymath}
The sequences for which the matrix are not valid are still interesting, because
the associated automaton still calculates most of the letters in the fixed
point correctly, but it leaves gaps.
Maybe we can somehow `repair' the automaton to correct this behaviour, but
this is (we think) beyond the scope of this document.

\section{Important notes}
As you have seen this document lacks all proof, so everything stated above
is pure conjecture. We have used a specially developed utility to check the
automaticity for various substitutions, so we are not entirely sure that
this method is even valid, though it seems acceptable at this time.\\
Since we use a greedy algorithm to make the enumeration system, we do not 
always find the right expansion (but it does exist).

\section{Proofs in progress}
\paragraph{Theorem} By using the greedy algorithm we shall always find an
enumeration system.
\paragraph{Proof}
\paragraph{Theorem} The substitutions of the form described above will 
always be automatic in their own number system.
\paragraph{Proof}
\paragraph{Theorem} All automatic substitutions are of the class described
above.
\paragraph{Proof} At least the borderpoints are in this class...
\paragraph{Theorem}
\paragraph{Proof}
\end{document}
